<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>TXTファイル一括結合ツール</title>
    <style>
        body {
            font-family: "メイリオ", sans-serif;
            background: #f5f5f5;
            padding: 30px;
            text-align: center;
        }
        h1 { color: #333; }
        #drop-area {
            border: 3px dashed #666;
            border-radius: 10px;
            padding: 40px;
            background: #fff;
            margin: 20px auto;
            width: 80%;
            max-width: 700px;
            transition: all 0.3s;
        }
        #drop-area.highlight {
            border-color: #007bff;
            background: #e7f3ff;
        }
        #file-list {
            margin: 20px 0;
            text-align: left;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background: #fff;
            border: 1px solid #ddd;
        }
        button {
            padding: 12px 30px;
            font-size: 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:disabled {
            background: #aaa;
            cursor: not-allowed;
        }
        .small { font-size: 0.9em; color: #666; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>TXTファイル結合ツール</h1>
    <p>複数のTXTファイルをここにドロップするか、クリックして選択してください。</p>

    <div id="drop-area">
        <p>ファイルをドラッグ＆ドロップ<br>またはクリックして選択</p>
        <input type="file" id="file-input" multiple accept=".txt,text/plain" style="display:none;">
    </div>

    <div id="file-list">選択されたファイル：なし</div>

    <button id="merge-btn" disabled>結合してダウンロード</button>

    <p class="small">
        ※ 結合順はファイル選択順（またはドロップ順）になります。<br>
        ※ 各ファイルの末尾に改行が自動で入ります（重複改行を避けたい場合は自分で調整してください）
    </p>

    <script>
        const dropArea = document.getElementById('drop-area');
        const fileInput = document.getElementById('file-input');
        const fileList = document.getElementById('file-list');
        const mergeBtn = document.getElementById('merge-btn');

        let filesArray = [];

        // ドラッグオーバー時のハイライト
        ['dragenter', 'dragover'].forEach(eventName => {
            dropArea.addEventListener(eventName, e => {
                e.preventDefault();
                e.stopPropagation();
                dropArea.classList.add('highlight');
            });
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, e => {
                e.preventDefault();
                e.stopPropagation();
                dropArea.classList.remove('highlight');
            });
        });

        // ドロップ処理
        dropArea.addEventListener('drop', e => {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles(files);
        });

        // クリックでファイル選択
        dropArea.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', e => handleFiles(e.target.files));

        function handleFiles(files) {
            filesArray = [...filesArray, ...Array.from(files).filter(f => f.type === 'text/plain' || f.name.endsWith('.txt'))];
            updateFileList();
        }

        function updateFileList() {
            if (filesArray.length === 0) {
                fileList.textContent = '選択されたファイル：なし';
                mergeBtn.disabled = true;
                return;
            }

            let html = '<strong>結合順（上から順）</strong><ol>';
            filesArray.forEach((file, index) => {
                html += `<li>${file.name} (${(file.size/1024).toFixed(1)} KB)</li>`;
            });
            html += '</ol>';
            fileList.innerHTML = html;
            mergeBtn.disabled = false;
        }

        // 結合＆ダウンロード
        mergeBtn.addEventListener('click', async () => {
            let combinedText = '';

            for (const file of filesArray) {
                const text = await file.text();
                combinedText += text;
                if (!text.endsWith('\n')) combinedText += '\n'; // ファイル間に改行を保証
            }

            const blob = new Blob([combinedText], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = '結合結果_' + new Date().toISOString().slice(0,19).replace(/:/g,'-') + '.txt';
            a.click();

            URL.revokeObjectURL(url);
        });
    </script>
</body>
</html>